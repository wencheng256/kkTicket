(function(){var c="";var d="";$(document).ready(function(){initPageTitle(0);$._index_init_style();$._index_initQueryInput();$._index_initChangeStation();$._index_initSearch();$._index_sessionUser();jQuery("#item_pic").slide({titCell:".pic-hd li",mainCell:".pic-bd ul",autoPlay:true,delayTime:1000,interTime:10000})});jQuery.extend({_index_initCookieValues:function(){var k=$.jc_getFromStation();if(k){var j=k.split(",");if(j&&j.length==2){$("#fromStationText").val(j[0]);$("#fromStation").val(j[1])}}var o=$.jc_getToStation();if(k){var j=o.split(",");if(j&&j.length==2){$("#toStationText").val(j[0]);$("#toStation").val(j[1])}}var i=$.jc_getFromDate();if(i){if(i>=initTrainDate&&i<=initToDate){$("#train_date").val(i)}else{$("#train_date").val(initTrainDate)}}else{$("#train_date").val(initTrainDate)}var m=$.jc_getToDate();if(m){if(m>=initTrainDate&&m<=initToDate){$("#back_train_date").val(m)}else{$("#back_train_date").val(initTrainDate)}}else{$("#back_train_date").val(initTrainDate)}var n=true;var l=$.jc_getWfOrDc();if(l&&"wf"==l){n=false;$("#_wf_span_date").removeClass("color999");$("#dc").attr("checked",false);$("#wf").attr("checked",true)}return n},_index_setCookieValues:function(){$.jc_setFromStation($("#fromStationText").val(),$("#fromStation").val());$.jc_setToStation($("#toStationText").val(),$("#toStation").val());$.jc_setFromDate($("#train_date").val());$.jc_setToDate($("#back_train_date").val());$.jc_setWfOrDc($("#wf").is(":checked")?"wf":"dc")},_index_init_style:function(){$("#ccTypeAll").css("cursor","pointer");$("#ccStartTimeAll").css("cursor","pointer");$("#ccArriveTimeAll").css("cursor","pointer");$("#ccSeatTypeAll").css("cursor","pointer");$("#change_station").css("cursor","pointer");$("#see_more").css("cursor","pointer");$("#date_normal").css("cursor","pointer");$("#dc").css("cursor","pointer");$("#wf").css("cursor","pointer");$("#from_station_imageB").css("cursor","pointer");$("#to_station_imageB").css("cursor","pointer");$("#back_imageClick").css("cursor","pointer");$("#from_imageClick").css("cursor","pointer")},_index_initQueryInput:function(){$.stationFor12306.init(["fromStation","toStation"],{_init_input:index_messages.jianma_hanzi,_top_4_initInput:index_messages.jianpin_hanzi,_unselected_class:"error",confirmCallBack:function(j){if(j[0]["id"]=="fromStationText"){if($("#toStationText").val()!=""&&$("#toStationText").val()!=index_messages.jianma_hanzi&&$("#toStationText").val()!=index_messages.jianpin_hanzi){$("#toStationText").select()}else{$("#toStationText").val("")}$("#toStationText").focus()}}});var i=$._index_initCookieValues();if(i){$("#back_train_date").attr("disabled",true);$("#_wf_span_date").addClass("color999")}$("#dc").click(function(){$("#_wf_span_date").addClass("color999");$("#back_train_date").removeClass("inp-txt_select");$("#wf").attr("checked",false);$(this).attr("checked","checked");$("#back_train_date").attr("disabled",true)});$("#wf").click(function(){$("#_wf_span_date").removeClass("color999");$("#dc").attr("checked",false);$(this).attr("checked","checked");$("#back_train_date").removeAttr("disabled");if($("#back_train_date").val()==""||$("#back_train_date").val()<$("#train_date").val()){$("#back_train_date").val($("#train_date").val())}});$("#from_station_imageB").click(function(){if($("#fromStationText").val()==index_messages.jianma_hanzi||$("#fromStationText").val()==index_messages.jianpin_hanzi){$("#fromStationText").val("")}$("#fromStationText").focus()});$("#to_station_imageB").click(function(){if($("#toStationText").val()==index_messages.jianma_hanzi||$("#toStationText").val()==index_messages.jianpin_hanzi){$("#toStationText").val("")}$("#toStationText").focus()});$("#back_imageClick").click(function(){if($("#wf").is(":checked")){$("#back_train_date").focus()}else{}});$("#from_imageClick").click(function(){$("#train_date").focus()});if($("#fromStationText").val()==""){$("#fromStationText").val(index_messages.jianma_hanzi)}if($("#toStationText").val()==""){$("#toStationText").val(index_messages.jianma_hanzi)}},_index_initChangeStation:function(){$("#change_station").click(function(){var n=$("#fromStationText");var l=n.val();var i=$("#toStationText");var m=i.val();var k=$("#toStation").val();var j=$("#fromStation").val();n.val(m);i.val(l);if(m!=""&&m!=index_messages.jianma_hanzi&&m!=index_messages.jianpin_hanzi){n.removeClass("inp-txt");n.addClass("inp-txt_select")}else{n.removeClass("inp-txt_select");n.addClass("inp-txt")}if(l!=""&&l!=index_messages.jianma_hanzi&&l!=index_messages.jianpin_hanzi){i.removeClass("inp-txt");i.addClass("inp-txt_select")}else{i.removeClass("inp-txt_select");i.addClass("inp-txt")}$("#fromStation").val(k);$("#toStation").val(j)})},_index_initSearch:function(i){$("#a_search_ticket").click(function(){$._index_toGoTicketQuery();if(i&&i.preventDefault){i.preventDefault()}else{window.event.returnValue=false}return false})},_index_sessionUser:function(){if(notify_SESSION&&"Y"==notify_SESSION){dhtmlx.alert({title:"温馨提示",ok:"确定",text:"本次登录成功！该用户已在其他地点登录，前次登录将被强制退出！",type:"alert-error"})}},_index_toGoTicketQuery:function(){var t="dc";var j=$("#fromStationText");var k=j.val();var s=$("#toStationText");var q=s.val();var o=e();if(""==k||k==index_messages.jianma_hanzi||k==index_messages.jianpin_hanzi){j.addClass("error");return}else{if(""==q||q==index_messages.jianma_hanzi||q==index_messages.jianpin_hanzi){s.addClass("error");return}else{if(q==k){f(index_messages.same_to_from_station,s);return}}}var r=$("#train_date");var m=r.val();if(""==m){r.addClass("error");return}else{if(m<initTrainDate||m>initToDate){f(index_messages.trainDate_not_in+"<br>"+initTrainDate+"到"+initToDate,r);return}else{if(!g(m)){f(index_messages.trainDate_error,r);return}}}var n=$("#back_train_date");var u=n.val();if($("#wf").is(":checked")){if(""==u){n.addClass("error");return}else{if(u<initTrainDate||u>initToDate){f(index_messages.backTrainDate_not_in+"<br>"+initTrainDate+"到"+initToDate,n);return}else{if(!g(u)){f(index_messages.backTrainDate_error,n);return}}}if(m>u){f(index_messages.error_date,r);return}t="wf"}var l=ctx+"leftTicket/init";var i=$("#fromStation").val();var p=$("#toStation").val();$._index_setCookieValues();otsRedirect("post",l,{"leftTicketDTO.from_station_name":k,"leftTicketDTO.to_station_name":q,"leftTicketDTO.from_station":i,"leftTicketDTO.to_station":p,"leftTicketDTO.train_date":m,back_train_date:u,flag:t,purpose_code:o,pre_step_flag:"index"})},getMindateForCal:function(){if($("#sf2").is(":checked")){c=studentMindate}else{c=otherMindate}return c},getMaxdateForCal:function(){if($("#sf2").is(":checked")){d=studentMaxdate}else{d=otherMaxdate}return d}});function e(){if($("#sf2").is(":checked")){return"0X00"}else{return"ADULT"}}function h(i){var m=i.split("-");var l=m[1];var k=m[2];var j=m[0];alert(a(Date.parse(l+"/"+k+"/"+j)));return Date.parse(l+"/"+k+"/"+j)}function f(j,i){dhtmlx.alert({title:messages["message.error"],ok:messages["button.ok"],text:j,type:"alert-error",callback:function(){if(i&&i.val()==index_messages.jianma_hanzi){i.val("")}if(i){i.focus()}}})}function b(k,j){var i=new Date(Date.parse(k.replace(/-/g,"/")));i.setDate(i.getDate()+j);return a(i)}function a(j){var k=j.getFullYear();var m=j.getMonth()+1;var l=j.getDate();var i=k+"-"+m+"-"+l;return i}function g(l){var j=l;var i=j.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);if(i==null){return false}var k=new Date(i[1],i[3]-1,i[4]);return(k.getFullYear()==i[1]&&(k.getMonth()+1)==i[3]&&k.getDate()==i[4])}$("#train_date").focus(function(){WdatePicker({doubleCalendar:true,minDate:$.getMindateForCal(),maxDate:$.getMaxdateForCal(),isShowClear:false,readOnly:true,qsEnabled:false,onpicked:function(){$("#train_date").blur();var j=$("#back_train_date").val();var i=$("#train_date").val();if($("#wf").is(":checked")){if(!j|i>j){$("#back_train_date").val(i)}}if(!$("#train_date").hasClass("inp-txt_select")){$("#train_date").addClass("inp-txt_select")}if($("#train_date").hasClass("error")){$("#train_date").removeClass("error")}}})});$("#back_train_date").focus(function(){WdatePicker({doubleCalendar:true,minDate:$("#train_date").val(),maxDate:$.getMaxdateForCal(),isShowClear:false,readOnly:true,qsEnabled:false,onpicked:function(){if(!$("#back_train_date").hasClass("inp-txt_select")){$("#back_train_date").addClass("inp-txt_select")}if($("#back_train_date").hasClass("error")){$("#back_train_date").removeClass("error")}$("#back_train_date").blur()}})});$("#back_imageClick").click(function(){$("#back_train_date").focus()})})();
